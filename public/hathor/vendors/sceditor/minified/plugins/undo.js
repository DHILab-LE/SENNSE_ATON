<<<<<<< HEAD
/* SCEditor v2.1.3 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(e){"use strict";sceditor.plugins.undo=function(){var r,o,e=this,u=0,a=50,n=[],c=[],s=!1,l=function(e){s=!0,o=e.value,r.sourceMode(e.sourceMode),r.val(e.value,!1),r.focus(),e.sourceMode?r.sourceEditorCaret(e.caret):r.getRangeHelper().restoreRange(),s=!1};e.init=function(){a=(r=this).undoLimit||a,r.addShortcut("ctrl+z",e.undo),r.addShortcut("ctrl+shift+z",e.redo),r.addShortcut("ctrl+y",e.redo)},e.undo=function(){var e=c.pop(),t=r.val(null,!1);return e&&!n.length&&t===e.value&&(e=c.pop()),e&&(n.length||n.push({caret:r.sourceEditorCaret(),sourceMode:r.sourceMode(),value:t}),n.push(e),l(e)),!1},e.redo=function(){var e=n.pop();return c.length||(c.push(e),e=n.pop()),e&&(c.push(e),l(e)),!1},e.signalReady=function(){var e=r.val(null,!1);o=e,c.push({caret:this.sourceEditorCaret(),sourceMode:this.sourceMode(),value:e})},e.signalValuechangedEvent=function(e){var t=e.detail.rawValue;0<a&&c.length>a&&c.shift(),!s&&o&&o!==t&&(n.length=0,(u+=function(e,t){var r,o,u,a,n=e.length,c=t.length,s=Math.max(n,c);for(r=0;r<s&&e.charAt(r)===t.charAt(r);r++);for(u=n<c?c-n:0,a=c<n?n-c:0,o=s-1;0<=o&&e.charAt(o-u)===t.charAt(o-a);o--);return o-r+1}(o,t))<20||u<50&&!/\s$/g.test(e.rawValue)||(c.push({caret:r.sourceEditorCaret(),sourceMode:r.sourceMode(),value:t}),u=0,o=t))}}}();
=======
/* SCEditor v3.2.0 | (C) 2017, Sam Clarke | sceditor.com/license */
!function(){"use strict";sceditor.plugins.undo=function(){var n,i,a,o,r=this,s="",c=0,u=!1,d=!1,l=!1,e=50,t=[],g=0;function f(e){if(d=!0,i.sourceMode(e.sourceMode),e.sourceMode)i.val(e.value,!1),i.sourceEditorCaret(e.caret);else if(i.getBody().innerHTML=e.value,e.caret){var t=i.getRangeHelper().selectedRange(),n=t,e=e.caret;try{var o=e.startPositions,r=e.endPositions;n.setStart(S(a,o),o[0]),n.setEnd(S(a,r),r[0])}catch(e){console&&console.warn&&console.warn("[SCEditor] Undo plugin lost caret",e)}i.getRangeHelper().selectRange(t)}i.focus(),d=!1}function p(e,t){var n=e[t];e[t]=function(){var e=u;!e&&!d&&o&&i.getRangeHelper().hasSelection()&&h(),u=!0,n.apply(this,arguments),e||(u=!1,d||(v(),s=""))}}function v(){g&&(t.length-=g,g=0),0<e&&t.length>e&&t.shift(),o={},h(),t.push(o)}function h(){var e=i.sourceMode();o.caret=e?i.sourceEditorCaret():function(e){if(e)return a.normalize(),{startPositions:y(e.startContainer,e.startOffset),endPositions:y(e.endContainer,e.endOffset)}}(i.getRangeHelper().selectedRange()),o.sourceMode=e,o.value=e?i.getSourceEditorValue(!1):i.getBody().innerHTML}function E(){n===document.activeElement&&r.signalSelectionchangedEvent()}function y(e,t){for(var n=[t],o=e;o&&"BODY"!==o.tagName;)n.push(function(e){var t=0;for(;e=e.previousSibling;)t++;return t}(o)),o=o.parentNode;return n}function S(e,t){for(var n=t.length-1;e&&0<n;n--)e=e.childNodes[t[n]];return e}r.init=function(){e=(i=this).undoLimit||e,i.addShortcut("ctrl+z",r.undo),i.addShortcut("ctrl+shift+z",r.redo),i.addShortcut("ctrl+y",r.redo)},r.signalReady=function(){function e(e){"historyUndo"===e.inputType?(r.undo(),e.preventDefault()):"historyRedo"===e.inputType&&(r.redo(),e.preventDefault())}function t(){s="",v()}n=i.getContentAreaContainer().nextSibling,a=i.getBody(),v(),p(i,"setWysiwygEditorValue"),p(i,"setSourceEditorValue"),p(i,"sourceEditorInsertText"),p(i.getRangeHelper(),"insertNode"),p(i,"toggleSourceMode"),a.addEventListener("beforeinput",e),n.addEventListener("beforeinput",e),a.addEventListener("compositionend",t),n.addEventListener("compositionend",t),document.addEventListener("selectionchange",E)},r.destroy=function(){document.removeEventListener("selectionchange",E)},r.undo=function(){return o=null,g<t.length-1&&(g++,f(t[t.length-1-g])),!1},r.redo=function(){return 0<g&&(g--,f(t[t.length-1-g])),!1},r.signalSelectionchangedEvent=function(){d||l?l=!1:(o&&h(),s="")},r.signalInputEvent=function(e){var t=e.inputType;if(l=!0,t&&!e.isComposing)switch(e.inputType){case"deleteContentBackward":o&&s===t&&c<20?h():(v(),c=0),s=t;break;case"insertText":c+=e.data?e.data.length:1,o&&s===t&&c<20&&!/\s$/.test(e.data)?h():(v(),c=0),s=t;break;default:s="sce-misc",c=0,v()}}}}();
>>>>>>> master
